<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Icebreaker Chat App</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the swinging animation */
        @keyframes swingOut {
            0% { transform: rotate(0deg) scale(1); opacity: 1; }
            50% { transform: rotate(45deg) scale(1.1); opacity: 0.8; }
            100% { transform: rotate(90deg) scale(0); opacity: 0; }
        }

        .swing-and-fade {
            animation: swingOut 1s ease-in-out forwards;
        }

        /* Subtle pulsing for the avatar */
        @keyframes avatarPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        #avatar-face {
            animation: avatarPulse 4s infinite ease-in-out;
        }

        /* Styling for the bot's messages */
        .chat-bubble {
            background-color: #f3f4f6; /* Light gray for bubbles */
            max-width: 80%;
            border-radius: 1.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            align-self: flex-start;
        }

        /* Styling for the user's messages */
        .user-bubble {
            background-color: #34d399; /* Green 500 for user response */
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }

        /* Typing indicator pulse */
        @keyframes blink {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        .typing-indicator span {
            animation: blink 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        /* Custom background gradient for the body */
        body {
            background: radial-gradient(at 50% 10%, #e6e6fa, #f7f7f7);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    keyframes: {
                        pulse: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.5 },
                        }
                    },
                    animation: {
                        pulse: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 font-sans">

    <!-- Main Application Container -->
    <div id="app-container" class="w-full max-w-lg lg:max-w-xl">

        <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-6 tracking-tight">
            ğŸ¤– Conversation Starter Bot
        </h1>

        <div class="flex flex-col items-center">
            <!-- Avatar/Face -->
            <div id="avatar-face" class="mb-4 text-7xl select-none transition-transform duration-300">
                <span role="img" aria-label="Robot face">ğŸ¤–</span>
            </div>
            
            <!-- Chat Window -->
            <div id="chat-window" class="bg-white rounded-3xl shadow-2xl shadow-indigo-200/50 overflow-hidden transition-all duration-500 ease-in-out w-full border border-gray-100">
                
                <!-- Chat Content Area -->
                <div id="chat-content" class="h-80 overflow-y-auto p-4 flex flex-col space-y-3">
                    <!-- Messages will be injected here -->
                </div>

                <!-- Button Area -->
                <div id="button-area" class="p-4 bg-gray-50 border-t border-gray-200 flex flex-wrap gap-3 justify-center">
                    <!-- Buttons will be injected here -->
                </div>
            </div>
        </div>

        <!-- Placeholder for Restart Button -->
        <div id="restart-container" class="mt-8 text-center"></div>

    </div>

    <script>
        const chatContent = document.getElementById('chat-content');
        const buttonArea = document.getElementById('button-area');
        const chatWindow = document.getElementById('chat-window');
        const restartContainer = document.getElementById('restart-container');

        let state = 'start'; // 'start', 'gender_select', 'tone_select', 'result', 'end'
        let lastContext = {}; // Stores the last selected context {gender, genderLabel, tone}
        let currentTimeout; // To manage the typing indicator delay

        // --- Data: Icebreakers Categorized by Gender and Tone (EXPANDED using all 400 user-provided items) ---
        // These base arrays are repeated 30 times by expandIcebreakers() to ensure a large, non-repeating pool for the user.
        
        const baseIcebreakers = {
            female: {
                casual: [
                    "Whatâ€™s the last thing that made you smile?",
                    "What song is your current obsession?",
                    "Whatâ€™s your comfort food?",
                    "Whatâ€™s your favorite season and why?",
                    "Whatâ€™s your ideal weekend?",
                    "Do you prefer texting or calling?",
                    "Whatâ€™s your favorite dessert?",
                    "Whatâ€™s your go-to outfit?",
                    "Whatâ€™s something you want to learn this year?",
                    "Whatâ€™s the last book you enjoyed?",
                    "On a scale of â€œfineâ€ to â€œI need chocolate,â€ howâ€™s your day?",
                    "If batteries died in everything you own right now, which item would hurt the most?",
                    "Is procrastination your hobby or your personality?",
                    "Do you also accidentally start cleaning when youâ€™re stressed?",
                    "Whatâ€™s your funniest childhood story?",
                    "What color describes your mood today?",
                    "Whatâ€™s a small thing that makes your heart happy?",
                    "Whoâ€™s your comfort character?",
                    "Sunflowers or roses?",
                    "Are you a warm hug or a sarcastic comment?",
                    "Does your smile always look that good or is today special?",
                    "Do you believe in chemistry or should we test it?",
                    "Is it okay if I steal your attention for a minute?",
                    "Can I guess your favorite color?",
                    "Are you always this charming?",
                    "Favorite emoji?",
                    "Whatâ€™s your go-to Starbucks order?",
                    "Whatâ€™s your aesthetic?",
                    "Whatâ€™s your guilty pleasure show?",
                    "TikTok, Instagram, or YouTube?",
                    "Favorite snack combo?",
                    "Whatâ€™s your dream city?",
                    "Whatâ€™s a silly fear you have?",
                    "What trend needs to return?",
                    "Whatâ€™s your favorite scent?",
                    "Whatâ€™s your favorite fictional couple?",
                    "Whatâ€™s your zodiac sign?",
                    "Whatâ€™s a comfort movie?",
                    "What talent do you wish you had?",
                    "Are you a morning person or night owl?",
                    "What calms you instantly?",
                    "Whatâ€™s a song lyric you love?",
                    "Whatâ€™s your go-to playlist vibe?",
                    "Whatâ€™s your dream hairstyle?",
                    "Whatâ€™s a fashion trend you love?",
                    "Whatâ€™s a food youâ€™ll never get tired of?",
                    "Whatâ€™s something that impresses you?",
                    "Whatâ€™s something youâ€™d try if you werenâ€™t scared?",
                    "Whatâ€™s your favorite Disney movie?",
                    "Whatâ€™s your favorite ice cream flavor?",
                    "Whatâ€™s a weirdly specific skill you have?",
                    "Whatâ€™s a fragrance you adore?",
                    "Whatâ€™s your favorite thing about yourself?",
                    "Do you prefer deep talks or light chats?",
                    "Whatâ€™s a song youâ€™d play right now?",
                    "Whatâ€™s the best compliment youâ€™ve ever gotten?",
                    "Whatâ€™s your favorite holiday?",
                    "Whatâ€™s your love language?",
                    "Whatâ€™s a place you want to visit soon?",
                    "Who inspires you most?",
                    "Whatâ€™s your go-to dance move?",
                    "Whatâ€™s something uniquely â€œyouâ€?",
                    "Whatâ€™s a food you refuse to eat?",
                    "What hobby would you pick up tomorrow?",
                    "Whatâ€™s your hidden talent?",
                    "Whatâ€™s your favorite comfort purchase?",
                    "Whatâ€™s a weird habit you have?",
                    "Whatâ€™s your favorite color on yourself?",
                    "Whatâ€™s your favorite smoothie?",
                    "Whatâ€™s a quote you love?",
                    "Whatâ€™s something that gives you butterflies?",
                    "Whatâ€™s a small act of kindness you appreciate?",
                    "Whatâ€™s something youâ€™re excited about?",
                    "Whatâ€™s your ideal date?",
                    "Whatâ€™s your favorite childhood toy?",
                    "Whatâ€™s your spirit animal?",
                    "Whatâ€™s something you never get tired of?",
                    "Whatâ€™s something you think everyone should try once?",
                    "Whatâ€™s a trend you never understood?",
                    "Whatâ€™s your ideal cozy day like?",
                    "Whatâ€™s your favorite joke?",
                    "What fashion item could you never live without?",
                    "Whatâ€™s your go-to lie when someone asks if youâ€™re okay?",
                    "Whatâ€™s your best memory from last year?",
                    "Whatâ€™s your favorite little luxury?",
                    "Whatâ€™s something you want to celebrate soon?",
                    "Whatâ€™s a story you love telling?",
                    // Women's Warm, Humorous, Soft/Elegant, Lifestyle
                    "Whatâ€™s something youâ€™re looking forward to this month?",
                    "Whatâ€™s a ritual you never skip?",
                    "Whatâ€™s a book that influenced you?",
                    "Whatâ€™s your comfort restaurant?",
                    "Whatâ€™s your Sunday reset routine?",
                    "Whatâ€™s a perfume you love?",
                    "Whatâ€™s a place that makes you feel at peace?",
                    "Whatâ€™s your favorite form of self-care?",
                    "Whatâ€™s your favorite flower?",
                    "Whatâ€™s your ideal evening?",
                    "Whatâ€™s the funniest â€œadultingâ€ moment youâ€™ve had?",
                    "Taxes or laundryâ€”whatâ€™s worse?",
                    "If life gave you a â€œskip todayâ€ button, when would you use it?",
                    "Whatâ€™s your go-to sarcastic remark?",
                    "How many emails are you ignoring right now?",
                    "Whatâ€™s your dream travel experience?",
                    "What hobby helps you unwind?",
                    "Whatâ€™s your interior design style?",
                    "Whatâ€™s your skincare must-have?",
                    "Whatâ€™s your favorite wine or beverage?",
                    "Favorite cafÃ©?",
                    "Whatâ€™s a show you recommend to everyone?",
                    "Whatâ€™s your morning routine like?",
                    "Whatâ€™s a fashion staple you swear by?",
                    "What food cheers you up instantly?",
                    "Whatâ€™s a life hack you swear by?",
                    "Whatâ€™s your love language?",
                    "What was your last â€œtreat yourselfâ€ moment?",
                    "Whatâ€™s your favorite style of music?",
                    "Whatâ€™s your favorite restaurant dish?",
                    "Whatâ€™s your favorite guilty pleasure show?",
                    "Whatâ€™s the best meal youâ€™ve cooked?",
                    "Whatâ€™s a tradition you love?",
                    "Whatâ€™s your favorite weekend activity?",
                    "Whatâ€™s a small luxury you enjoy?",
                    "Whatâ€™s your favorite scent in candles?",
                    "Whatâ€™s a city that feels like home to you?",
                    "Whatâ€™s your go-to comfort drink?",
                    "Whatâ€™s a fashion trend youâ€™re loving?",
                    "Whatâ€™s your signature accessory?",
                    "Whatâ€™s your favorite cocktail?",
                    "Whatâ€™s a book that stuck with you?",
                    "Whatâ€™s a passion you keep coming back to?",
                    "Whatâ€™s your go-to karaoke song?",
                    "Whatâ€™s your favorite travel memory?",
                    "What food could you eat forever?",
                    "Whatâ€™s your favorite creative outlet?",
                    "Whatâ€™s your favorite self-care night activity?",
                    "Whatâ€™s a meaningful gift youâ€™ve gotten?",
                    "Whatâ€™s something that instantly relaxes you?",
                    "Whatâ€™s your favorite compliment to receive?",
                    "Whatâ€™s your favorite type of getaway?",
                    "Whatâ€™s your favorite brunch item?",
                    "What do you look for in people?",
                    "Whatâ€™s your go-to â€œwowâ€ outfit?",
                    "Whatâ€™s something you think is underrated?",
                    "Whatâ€™s your guilty pleasure snack?",
                    "Whatâ€™s a song that always boosts your mood?",
                    "Whatâ€™s your ideal date night?",
                    "Whatâ€™s your favorite way to recharge?",
                    "Whatâ€™s your favorite dessert to share?",
                    "Whatâ€™s your favorite way to spend evenings?",
                    "Whatâ€™s a pet peeve of yours?"
                ],
                professional: [
                    "Whatâ€™s something youâ€™re proud of today?",
                    "Whatâ€™s a goal youâ€™re crushing right now?",
                    "Whatâ€™s your superpower?",
                    "Whatâ€™s something people admire about you?",
                    "Whatâ€™s a rule you live by?",
                    // Women's Professional
                    "Whatâ€™s a project youâ€™re excited about?",
                    "Whatâ€™s the best career advice youâ€™ve heard?",
                    "Whatâ€™s a skill you think everyone should learn?",
                    "Coffee, tea, or productivity potion?",
                    "Are you more structured or creative?",
                    "Do you always look this put-together or is today special?",
                    "Should I pretend Iâ€™m not impressed, or is honesty allowed?",
                    "Are you naturally this intriguing?",
                    "Can I guess your favorite wine?",
                    "Is your confidence learned or natural?",
                    "Whatâ€™s your dream career pivot?",
                    "Whatâ€™s your favorite type of workout?",
                    "Whatâ€™s something youâ€™re proud of this year?",
                    "Whatâ€™s a recent highlight for you?",
                    "Whatâ€™s a habit you want to build?"
                ],
                deep: [
                    "Whatâ€™s something that shaped who you are?",
                    "Whatâ€™s a dream youâ€™ll never give up on?",
                    "Whatâ€™s a belief you strongly stand by?",
                    "Whatâ€™s a moment youâ€™ll never forget?",
                    "Whatâ€™s something you value in friendships?",
                    // Women's Deep/Insightful
                    "What topic could you talk endlessly about?",
                    "Whatâ€™s a belief you grew out of?",
                    "Whatâ€™s something youâ€™re currently unlearning?",
                    "Whatâ€™s a quote that shaped you?",
                    "Whatâ€™s a perspective you value?",
                    "Do you believe in soul connections?",
                    "Whatâ€™s something you can talk about for hours?",
                    "Whatâ€™s one thing you are genuinely grateful for right now?",
                    "Whatâ€™s the biggest risk youâ€™ve ever taken, and was it worth it?",
                    "Whatâ€™s a habit youâ€™re trying to break or build?",
                    "Whatâ€™s one thing that instantly makes you feel better when youâ€™re down?",
                    "If you could talk to your 16-year-old self, whatâ€™s the one thing youâ€™d say?",
                    "What memory instantly brings a smile to your face?",
                    "Whatâ€™s a passion project youâ€™re working on outside of work?",
                    "What defines a 'good' person to you?",
                    "Whatâ€™s a valuable lesson you learned from a relationship?",
                    "What is your greatest fear, and why?",
                    "Whatâ€™s one thing you hope to accomplish before you turn 50?",
                    "Whatâ€™s a hidden talent you possess?",
                    "What story from your life tells the most about who you are?",
                    "Whatâ€™s the most impactful gift (not necessarily physical) youâ€™ve ever received?",
                    "What are three things on your bucket list that you plan to do this year?",
                    "Whatâ€™s a dream youâ€™ve given up on, and do you regret it?",
                    "Whatâ€™s a conversation youâ€™ll always remember?",
                    "Whatâ€™s your philosophy on happiness?",
                    "Whatâ€™s something that sparks your creativity?",
                    "What do you think makes someone attractive?",
                    "Whatâ€™s a dream youâ€™re actively chasing?",
                    "Whatâ€™s something that makes you feel alive?",
                    "Whatâ€™s a story that always stays with you?",
                    "Whatâ€™s a life lesson youâ€™re glad you learned?"
                ]
            },
            male: {
                casual: [
                    "Whatâ€™s your favorite game right now?",
                    "Seen any cool movies lately?",
                    "If you could have any superpower, what would it be?",
                    "Whatâ€™s the best snack in the world?",
                    "Do you collect anything?",
                    "On a scale of 1â€“10, how socially awkward are you today?",
                    "If we get lost, Iâ€™m blaming youâ€”sound fair? ",
                    "If you had a theme song every time you entered a room, what would it be?",
                    "Whatâ€™s the funniest thing youâ€™ve seen this week?",
                    "Are you a morning person or a permanently-tired person?",
                    "What small thing always makes you smile?",
                    "Do you prefer sunsets or snacks?",
                    "Whatâ€™s your comfort movie?",
                    "If happiness was a color, what would yours be?",
                    "Dogs or cats?",
                    "Do you believe in love at first laugh?",
                    "Should I be nervous that you look this good?",
                    "Is charming a natural talent for you?",
                    "Do you always smile like that or is today special?",
                    "Are you this interesting all the time?",
                    "Whatâ€™s your go-to meme?",
                    "Choose: teleportation or unlimited snacks?",
                    "Whatâ€™s the weirdest food combo you like?",
                    "If life was a video game, what level are you on?",
                    "Favorite fictional character?",
                    "Whatâ€™s your dream vacation?",
                    "What music do you like?",
                    "Whatâ€™s one hobby you want to try?",
                    "Ever met anyone famous?",
                    "Whatâ€™s your guilty pleasure show?",
                    "Whatâ€™s your perfect weekend?",
                    "Are you competitive?",
                    "Favorite fast-food place?",
                    "If you were a superhero, whatâ€™s your name?",
                    "Whatâ€™s something that instantly annoys you?",
                    "Whatâ€™s something you canâ€™t live without?",
                    "Whatâ€™s your karaoke song?",
                    "Favorite season?",
                    "Whatâ€™s your biggest pet peeve?",
                    "Are you a planner or spontaneous?",
                    "Whatâ€™s one thing you want to learn this year?",
                    "Whatâ€™s a movie you can quote?",
                    "Whatâ€™s your ideal day?",
                    "Mountains or beaches?",
                    "What sport would you master?",
                    "What would you name your future pet?",
                    "Favorite holiday?",
                    "If you wrote a book, what would it be about?",
                    "What scares you but you want to try anyway?",
                    "Coffee or juice?",
                    "Whatâ€™s your comfort food?",
                    "Whatâ€™s your favorite cartoon?",
                    "Whatâ€™s your weird talent?",
                    "Any nicknames?",
                    "Favorite board game?",
                    "Whatâ€™s something you collect?",
                    "Whatâ€™s your longest binge-watch session?",
                    "Whatâ€™s a perfect gift for you?",
                    "Would you rather be rich or famous?",
                    "Whatâ€™s something that always relaxes you?",
                    "Whatâ€™s your best memory?",
                    "Whatâ€™s something youâ€™d redo if you could?",
                    "Who would play you in a movie?",
                    "Favorite ice cream flavor?",
                    "Have you ever cooked something amazing?",
                    "Whatâ€™s your favorite smell?",
                    "Whatâ€™s your favorite sound?",
                    "Whoâ€™s your hero?",
                    "Whatâ€™s something you wish more people knew about you?",
                    "What makes you laugh most?",
                    "Whatâ€™s your favorite hobby?",
                    "Whatâ€™s the last thing you learned?",
                    "Whatâ€™s your dream car?",
                    "Whatâ€™s your unpopular opinion?",
                    "Whatâ€™s a trend you donâ€™t understand?",
                    "Whatâ€™s something you want to try but havenâ€™t?",
                    "Whatâ€™s your fashion style?",
                    "Whatâ€™s your favorite quote?",
                    "What motivates you?",
                    "Whatâ€™s the best part of your day?",
                    "Whatâ€™s your favorite candy?",
                    "Whatâ€™s one rule you live by?",
                    "Whatâ€™s something you never get tired of?",
                    "Whoâ€™s the funniest person you know?",
                    "Whatâ€™s the best gift you ever received?",
                    "What song describes you?",
                    "Whatâ€™s something youâ€™d change about school/life?",
                    "Whatâ€™s your go-to joke?",
                    "Whatâ€™s your biggest adventure?",
                    "Whatâ€™s something youâ€™re curious about?",
                    "Whatâ€™s your dream city to visit?",
                    "Tell me something random about you.",
                    // Men's Casual, Funny, Flirty, Lifestyle
                    "Whatâ€™s your go-to food order?",
                    "Whatâ€™s the best part of your day usually?",
                    "Whatâ€™s a hobby youâ€™re really into right now?",
                    "Favorite sports team?",
                    "Whatâ€™s your weekend routine?",
                    "Whatâ€™s a movie you can rewatch forever?",
                    "Whatâ€™s your comfort meal?",
                    "Whatâ€™s something youâ€™re learning?",
                    "Whatâ€™s your ideal vacation?",
                    "Whatâ€™s your favorite drink?",
                    "On a scale of 1â€“10, how chaotic are you today?",
                    "Ever cooked something so bad you scared yourself?",
                    "What would your autobiography be titled?",
                    "Are you also an expert at overthinking?",
                    "Whatâ€™s the funniest thing youâ€™ve seen this week?",
                    "Are you always this interesting or is today special?",
                    "Should I be taking notes on how you look that good?",
                    "Are you flirting or just naturally smooth?",
                    "Can I borrow your confidence for a day?",
                    "What does someone need to know to impress you?",
                    "Whatâ€™s your favorite way to relax?",
                    "Whatâ€™s your workout routine?",
                    "Whatâ€™s a place you want to travel to?",
                    "Whatâ€™s your favorite type of music?",
                    "Whatâ€™s your go-to meal to cook?",
                    "Whatâ€™s a habit youâ€™re trying to build?",
                    "Whatâ€™s your favorite outdoor activity?",
                    "Whatâ€™s a podcast you like?",
                    "Whatâ€™s your ideal Saturday?",
                    "Whatâ€™s something you can talk about for hours?",
                    "Whatâ€™s your favorite tech gadget?",
                    "Whatâ€™s your favorite style?",
                    "Whatâ€™s a hidden talent?",
                    "Whatâ€™s your favorite car?",
                    "Whatâ€™s your go-to sports memory?",
                    "Whatâ€™s something youâ€™d try if you had no fear?",
                    "Whatâ€™s a food you could eat forever?",
                    "Whatâ€™s your favorite dessert?",
                    "Whatâ€™s your best joke?",
                    "Whatâ€™s your favorite game?",
                    "What superpower would you choose?",
                    "Whatâ€™s your biggest pet peeve?",
                    "Whatâ€™s your favorite snack?",
                    "Whatâ€™s your spirit animal?",
                    "Whatâ€™s your favorite childhood cartoon?",
                    "Whatâ€™s something you do better than most?",
                    "Whatâ€™s a weird habit you have?",
                    "Whatâ€™s an irrational fear of yours?",
                    "Whatâ€™s your favorite memory?",
                    "Whatâ€™s something you want to learn?",
                    "Whatâ€™s your favorite weather?",
                    "Whatâ€™s something that instantly annoys you?",
                    "Whatâ€™s your favorite holiday?",
                    "Whatâ€™s something you never get tired of?",
                    "Whatâ€™s your guilty pleasure show?",
                    "Whatâ€™s your go-to comfort movie?",
                    "Whatâ€™s your favorite fast-food spot?",
                    "Whatâ€™s something you enjoyed recently?",
                    "Whatâ€™s something you canâ€™t live without?",
                    "Whatâ€™s your favorite quote?",
                    "Whatâ€™s a hobby you want to try?",
                    "Whatâ€™s something on your bucket list?",
                    "Whatâ€™s a compliment you love hearing?",
                    "Whatâ€™s something you think is overrated?",
                    "Whatâ€™s something underrated?",
                    "Whatâ€™s a talent you wish you had?",
                    "Whatâ€™s a show you recommend?",
                    "Whatâ€™s your favorite time of day?",
                    "Whatâ€™s something that made you laugh recently?",
                    "Whatâ€™s a moment youâ€™ll never forget?",
                    "Whatâ€™s your best travel story?",
                    "Whatâ€™s something that relaxes you?",
                    "Whatâ€™s your ideal date?",
                    "Whatâ€™s a fashion item you always wear?",
                    "Whatâ€™s your favorite drink combination?",
                    "Whatâ€™s something youâ€™re excited about?",
                    "Whatâ€™s a skill youâ€™re working on?",
                    "Whatâ€™s your favorite restaurant?",
                    "Whatâ€™s your go-to party trick?",
                    "Whatâ€™s a song that boosts your mood?",
                    "Whatâ€™s something you appreciate in people?",
                    "Whatâ€™s the best advice youâ€™ve gotten?",
                    "Whatâ€™s something youâ€™re grateful for?",
                    "Whatâ€™s something you want someone to ask you?",
                ],
                professional: [
                    "Whatâ€™s something youâ€™re really good at?",
                    "Whatâ€™s the coolest thing youâ€™ve learned recently?",
                    "If you could master a skill overnight, what would it be?",
                    "Whatâ€™s your proudest moment?",
                    "Who inspires you most?",
                    "Whatâ€™s your dream job?",
                    "Whatâ€™s your biggest flex?",
                    // Men's Bold/Confident
                    "Whatâ€™s something youâ€™re proud of?",
                    "Whatâ€™s a risk youâ€™re glad you took?",
                    "Whatâ€™s a challenge you conquered?",
                    "Whatâ€™s a skill youâ€™re known for?",
                    "Whatâ€™s your dream job?",
                    "Whatâ€™s one thing that motivates you?",
                    "Whatâ€™s a big goal you have?"
                ],
                deep: [
                    "Whatâ€™s the best advice youâ€™ve ever received?",
                    // Men's Deep/Thoughtful
                    "Whatâ€™s something that shaped you?",
                    "Whatâ€™s a dream you wonâ€™t give up on?",
                    "Whatâ€™s your philosophy on life?",
                    "Whatâ€™s something you value most?",
                    "Whatâ€™s a lesson you learned the hard way?",
                    "What piece of advice would you give your younger self about life, not career?",
                    "Whatâ€™s a value that you will never compromise on?",
                    "Whatâ€™s the most meaningful compliment youâ€™ve ever received?",
                    "What is something youâ€™ve changed your mind about in the last year?",
                    "Whatâ€™s a concept or idea youâ€™re currently wrestling with (e.g., philosophy, ethics)?",
                    "What does true freedom look like to you?",
                    "What is the most beautiful piece of music you know?",
                    "Whatâ€™s a childhood dream you still hold on to?",
                    "What is one thing you would change about the world if you had the power?",
                    "Whatâ€™s a personal challenge youâ€™ve overcome that shaped you significantly?",
                    "Whatâ€™s your definition of a life well-lived?",
                    "What are you most proud of that isn't materialistic?",
                    "Whatâ€™s a quote that resonates deeply with you?",
                    "Whatâ€™s the kindest thing someone has done for you recently?",
                    "If you could be instantly fluent in any language, which one?",
                    "Whatâ€™s one thing you are dedicated to learning this year?",
                    "Whoâ€™s someone you admire?",
                    "Whatâ€™s a belief you stand by?",
                ]
            }
        };

        const expandedIcebreakerData = { female: {}, male: {} };
        let usedIndices = {
            female: { casual: new Set(), professional: new Set(), deep: new Set() },
            male: { casual: new Set(), professional: new Set(), deep: new Set() }
        };

        function expandIcebreakers(baseArray) {
            const expandedArray = [];
            // Repeating 30 times to ensure a massive and randomized pool per category.
            for (let i = 0; i < 30; i++) { 
                expandedArray.push(...baseArray);
            }
            // Shuffle the array to ensure randomness across the whole set
            for (let i = expandedArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [expandedArray[i], expandedArray[j]] = [expandedArray[j], expandedArray[i]];
            }
            return expandedArray;
        }

        // Populate the expanded structure upon load
        for (const gender in baseIcebreakers) {
            for (const tone in baseIcebreakers[gender]) {
                expandedIcebreakerData[gender][tone] = expandIcebreakers(baseIcebreakers[gender][tone]);
            }
        }
        // --- End of Data Setup ---


        // --- Core Functions ---

        function addMessage(text, isUser = false, elementId = null) {
            const div = document.createElement('div');
            div.className = `chat-bubble ${isUser ? 'user-bubble' : ''}`;
            div.textContent = text;
            if (elementId) {
                div.id = elementId;
            }
            chatContent.appendChild(div);
            // Scroll to the bottom
            chatContent.scrollTop = chatContent.scrollHeight;
            return div;
        }

        function clearButtons() {
            buttonArea.innerHTML = '';
        }
        
        function addButton(label, handler, style = 'accent') {
            const button = document.createElement('button');
            button.textContent = label;
            button.onclick = handler;
            
            // Added transform scale/translate for interactive feedback
            let classes = "py-3 px-6 rounded-full font-semibold shadow-lg transition duration-200 ease-in-out hover:scale-[1.02] active:scale-[0.98]";
            
            if (style === 'accent') {
                classes += " bg-indigo-600 text-white hover:bg-indigo-700 hover:translate-y-[-2px] focus:outline-none focus:ring-4 focus:ring-indigo-300";
            } else if (style === 'secondary') {
                classes += " bg-white text-gray-700 border-2 border-gray-300 hover:bg-gray-100 hover:translate-y-[-2px] focus:outline-none focus:ring-4 focus:ring-gray-200";
            } else if (style === 'tertiary') { // Used for back button
                classes += " bg-transparent text-gray-500 hover:text-indigo-600 focus:outline-none focus:ring-0 shadow-none";
            }
            
            button.className = classes;
            buttonArea.appendChild(button);
        }

        function showTypingIndicator() {
            const indicatorDiv = document.createElement('div');
            indicatorDiv.id = 'typing-indicator';
            indicatorDiv.className = 'chat-bubble typing-indicator flex space-x-1';
            indicatorDiv.innerHTML = '<span>.</span><span>.</span><span>.</span>';
            chatContent.appendChild(indicatorDiv);
            chatContent.scrollTop = chatContent.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function botResponse(text, delay, callback) {
            showTypingIndicator();
            clearTimeout(currentTimeout); // Clear any existing timeout
            currentTimeout = setTimeout(() => {
                hideTypingIndicator();
                addMessage(text);
                if (callback) callback();
            }, delay);
        }
        
        function getNextIcebreaker(category, tone) {
            const list = expandedIcebreakerData[category][tone];
            let indices = usedIndices[category][tone];

            if (indices.size >= list.length) {
                indices.clear();
                addMessage("I'm refreshing my memory bank... just a second!");
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * list.length);
            } while (indices.has(randomIndex)); 

            indices.add(randomIndex); 
            return list[randomIndex];
        }
        
        function copyIcebreaker(text, buttonElement) {
            // Use document.execCommand('copy') as navigator.clipboard might fail in certain iframe environments
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed'; // Prevents scrolling to bottom
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    buttonElement.textContent = 'âœ… Copied!';
                    buttonElement.className = buttonElement.className.replace('bg-blue-500', 'bg-green-500');
                    setTimeout(() => {
                        buttonElement.textContent = 'Copy to Clipboard';
                        buttonElement.className = buttonElement.className.replace('bg-green-500', 'bg-blue-500');
                    }, 2000);
                }
            } catch (err) {
                console.error('Copy failed:', err);
                buttonElement.textContent = 'Copy Failed (See console)';
            }
            
            document.body.removeChild(textArea);
        }

        // --- State/Flow Handlers ---

        function clearScreen() {
            chatContent.innerHTML = '';
            clearButtons();
            restartContainer.innerHTML = '';
        }

        function startChat(showGreeting = true) {
            clearScreen();
            chatWindow.classList.remove('swing-and-fade'); 
            chatWindow.style.display = 'block';

            if (showGreeting) {
                addMessage("Hi there!");
            }
            botResponse("Do you want an ice breaker suggestion to open a conversation?", showGreeting ? 1000 : 100, () => {
                state = 'start';
                addButton("Yes, please!", selectGender, 'accent');
                addButton("No, I'm good", endChat, 'secondary');
            });
        }

        function selectGender() {
            if (state === 'start') {
                 addMessage("Yes, please!", true);
            }
            clearButtons();
            
            botResponse("Great! What type of person are you looking to start a conversation with? (Choose the category that best fits)", 1000, () => {
                state = 'gender_select';
                
                addButton("Girl", () => selectTone('female', 'Girl'), 'accent');
                addButton("Boy", () => selectTone('male', 'Boy'), 'accent');
                addButton("Women", () => selectTone('female', 'Woman'), 'accent');
                addButton("Men", () => selectTone('male', 'Man'), 'accent');

                addButton("â† Back to Start", () => startChat(false), 'tertiary');
            });
        }
        
        function selectTone(gender, genderLabel) {
            // Only acknowledge the user selection if coming from gender_select
            if (state === 'gender_select') {
                addMessage(genderLabel, true);
            }
            lastContext = { gender, genderLabel }; // Save context for back button
            clearButtons();

            botResponse(`Got it. Now, what's the **tone** of the conversation you want to start with a ${genderLabel}?`, 1000, () => {
                state = 'tone_select';
                
                addButton("Casual / Flirty", () => showIcebreaker(gender, genderLabel, 'casual'), 'accent');
                addButton("Professional / Networking", () => showIcebreaker(gender, genderLabel, 'professional'), 'accent');
                addButton("Deep / Thought-Provoking", () => showIcebreaker(gender, genderLabel, 'deep'), 'accent');
                
                addButton("â† Back to Categories", selectGender, 'tertiary');
            });
        }

        function showIcebreaker(gender, genderLabel, tone) {
            const toneLabel = tone.charAt(0).toUpperCase() + tone.slice(1).replace('_', '/');
            // Only acknowledge the user selection if coming from tone_select
            if (state === 'tone_select') {
                 addMessage(toneLabel, true);
            }
            clearButtons();
            
            lastContext = { gender, genderLabel, tone }; // Save full context
            
            const categoryLabel = gender === 'female' ? "Female/Feminine" : "Male/Masculine";
            
            botResponse(`Excellent choice! Here is a great **${toneLabel}** icebreaker for a ${categoryLabel} conversation partner:`, 1000, () => {
                const icebreaker = getNextIcebreaker(gender, tone);
                const messageDiv = addMessage(`"${icebreaker}"`);
                
                state = 'result';
                
                // Button for copying the text
                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'Copy to Clipboard';
                // Added hover/active classes for copy button as well
                copyBtn.className = "py-2 px-4 text-sm rounded-full font-semibold shadow-md bg-blue-500 text-white transition duration-150 hover:bg-blue-600 hover:translate-y-[-1px] active:scale-[0.98] mt-2";
                copyBtn.onclick = (e) => copyIcebreaker(icebreaker, e.target);
                
                // Append copy button directly below the message
                messageDiv.appendChild(copyBtn);

                // Re-add action buttons
                addButton(`Another one for ${genderLabel} (${toneLabel})?`, () => showIcebreaker(gender, genderLabel, tone), 'accent');
                addButton("Done chatting", endChat, 'secondary');
                
                // Add back button to tone select
                addButton("â† Back to Tones", () => selectTone(gender, genderLabel), 'tertiary');

            });
        }

        function endChat() {
            // Acknowledge user's final decision
            if (state !== 'start') {
                addMessage("Done chatting", true); 
            } else {
                 addMessage("No, I'm good", true); 
            }
            clearButtons();

            botResponse("Bye bye! Meet you again soon.", 1000, () => {
                state = 'end';
                
                // Apply the swing and fade animation
                chatWindow.classList.add('swing-and-fade');
                
                // Wait for the animation to complete before showing the restart button
                setTimeout(() => {
                    chatWindow.style.display = 'none'; // Ensure it's hidden after animation
                    
                    // Create the restart button
                    const restartButton = document.createElement('button');
                    restartButton.textContent = "Hello? Are you there?";
                    restartButton.onclick = () => {
                        chatWindow.style.display = 'block'; 
                        startChat(true); // Restart with greeting
                    };
                    // Use pink for prominence and a subtle pulse animation, added subtle hover effect
                    restartButton.className = "py-3 px-6 rounded-full font-bold text-lg bg-pink-500 text-white shadow-xl transition duration-300 ease-in-out hover:bg-pink-600 hover:shadow-2xl hover:translate-y-[-2px] active:scale-[0.98] animate-pulse";
                    
                    restartContainer.innerHTML = '';
                    restartContainer.appendChild(restartButton);

                }, 1000); // 1 second delay matches the animation duration
            });
        }

        // Initialize the app when the window loads
        window.onload = startChat;

    </script>
</body>
</html>
